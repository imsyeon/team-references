# 쿠키(Cookie)와 세션(Session)

## 쿠키와 세션을 사용하는 이유

- HTTP 프로토콜의 특성이자 약점을 보완하기 위해 사용
    1. Connectionless 프로토콜
        - 비연결지향
        - 클라이언트가 서버에 요청(request) 시 그 요청에 맞는 응답(response)을 보낸 후 연결을 끊는 방식
    2. Stateless 프로토콜
        - 통신이 끝나면 상태를 유지하지 않음
        - 클라이언트의 상태 정보를 가지지 않는 서버 처리 방식   
        ex) 클라이언트와 첫번째 통신에서 데이터를 주고 받았다 해도,
두번째 통신에서 이전 데이터를 유지하지 않음
- 실제로는 데이터 유지가 필요한 경우가 많기 때문에 쿠키와 세션을 사용함
    + 만약 데이터 유지가 안 될 시에 매번 페이지를 이동할 때 마다 로그인을 해야 하는 경우가 생김
- 결론적으로 클라이언트와 정보 유지를 하기 위함

## 쿠키(Cookie)

- 클라이언트(브라우저) 로컬에 저장되는 키와 값이 들어있는 작은 데이터 파일
- 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지됨
- HTTP에서 클라이언트의 상태 정보를 클라이언트의 PC에 저장하였다가
필요 시 정보를 참조하거나 재사용 가능
- Response Header에 Set-Cookie 속성을 사용하면 클라이언트에 쿠키 생성 가능
- 쿠키는 사용자가 따로 요청하지 않아도 브라우저가 Request시에 Request Header를 넣어서 자동으로 서버에 전송

- 구성 요소
    + 이름 : 각각의 쿠키를 구별하는 데 사용되는 이름
    + 값 : 쿠키의 이름과 관련된 값
    + 유효시간 : 쿠키의 유지시간
    + 도메인 : 쿠키를 전송할 도메인
    + 경로 : 쿠키를 전송할 요청 경로

- 쿠키의 동작 순서
    1. 클라이언트가 페이지를 요청 (사용자가 웹사이트 접근)
    2. 웹 서버에서 쿠키 생성
    3. HTTP 헤더에 쿠키를 포함 시켜 응답
    4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트(로컬 PC)에서 보관
    5. 같은 요청을 할 경우 클라이언트의 PC에 해당 쿠키가 있으면 요청 페이지와 함께 HTTP 헤더에 쿠키를 전송

## 세션(Session)

- 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지하게 해 주는 기술
- 쿠키를 기반으로 하고 있음 (웹 서버의 저장되는 쿠키)
- 세션은 서버 측에서 관리
- 서버에서는 클라이언트를 구분하기 위해 고유 Session ID를 부여
- 사용자에 대한 정보를 서버에 두기 때문에 쿠키보다 보안면에서 우수함 
- 사용자가 많아질수록 서버 메모리를 많이 차지하게 됨
- 세션의 동작 순서
    1. 클라이언트가 페이지를 요청 (사용자가 웹사이트 접근)
    2. 서버는 접근한 클라이언트의 Request-Header 필드인 Cookie를 확인 후 클라이언트가 해당 session-id를 보냈는지 확인
    3. session-id가 존재하지 않을 시에 서버는 session-id를 생성해 클라이언트에게 돌려줌
    4. 서버에서 클라이언트로 돌려준 session-id를 쿠키를 사용해 서버에 저장
       - 쿠키 이름 : JSESSIONID
    5. 클라이언트는 재접속 시, 이 쿠키(JSESSIONID)를 이용하여 session-id 값을 서버에 전달

![image](https://user-images.githubusercontent.com/86212069/167972957-df462dc8-c874-46ba-b003-89307676a8c0.png)

### session의 장점

- 사용자는 session-id만 지니게 되고 중요한 정보들은 서버가 갖고 있기 때문에 요청을 탈취당해도 session-id만 노출
- session-id는 특정 유저에게만 할당되기 때문에 session-id와 매칭된 회원정보를 바로 확인이 가능하며 DB에서 확인하기 용이함
- 서버에서 session 통제가 가능

### session의 단점

- 서버를 증설해 A서버와 B서버가 있다고 가정할 경우, A서버와 B서버에서의 session 정보가 일치하지 않음
- 확장성이 떨어짐
- 요청이 많을 시 서버에 부하가 심해짐

### 정리

- 쿠키와 세션의 가장 큰 차이점은 사용자의 정보가 저장되는 위치에 있음
- 보안 면에서는 세션이 더 우수하지만 요청 속도는 쿠키가 세션보다 더 우수함
    + 쿠키는 파일에서 읽기 때문에 상대적으로 빠르고, 세션은 요청 마다 서버에서 처리를 해야 하기 때문에 비교적 느림
- 세션 대신 쿠키를 사용하는 이유
    + 세션은 서버의 자원을 사용하기 때문에 무분별하게 만들다보면 서버의 메모리가 감당할 수 없어질 수가 있으며, 속도가 느려질 수 있기 때문에 쿠키가 유리한 경우가 존재함

