# OpenStack instance 생성 

## 1. 네트워크 생성

> 프로젝트 > 네트워크 > 네트워크 > 네트워크 생성

### 1.1 네트워크

- 이름 : c3-private-{별명}-{숫자} ex) c3-private-joy-1
- 프로젝트 : paas-ta-c3
- '공유'에 체크

※ 관리 탭에서 생성 시
- 구분 ID : 네트워크에서 유효한 ID(1 ~ 16777215)
- 공급자 네트워크 유형 : VXLAN 


※ 위의 항목들 입력 후 '서브넷' 탭에서 아래 내용 참고하여 값 입력(하나만 입력 가능)

> 생성된 네트워크 이름 클릭 > 서브넷 > 서브넷 생성

### 1.2 서브넷

- 이름 : {네트워크명}-sn-{zone}
  + 예시
    - public :: c3-private-joy-1-sn-0
    - private :: zone 1 ~ zone 6
      + zone 1 :: c3-private-joy-1-sn-1
      + zone 2 :: c3-private-joy-1-sn-2
      + zone 3 :: c3-private-joy-1-sn-3
      + zone 4 :: c3-private-joy-1-sn-4
      + zone 5 :: c3-private-joy-1-sn-5
      + zone 6 :: c3-private-joy-1-sn-6

- 네트워크 주소 : CIDR 형식의 네트워크 주소
  + 형식
    - public zone :: 10.200.x0.0/24<br>ex) 10.200.50.0/24
    - private zone :: 10.200.xx.0/24<br>ex) zone 1 → 10.200.51.0/24

- 게이트웨이 IP : 게이트웨이의 IP 주소
  + 맨 끝자리 1 ex) zone 1 → 10.200.50.1

### 1.3 서브넷 세부 정보

- Pools 할당 : 풀에 할당된 IP 주소
  + start와 end는 ','로 구분 ex) zone1 → 10.200.51.2,10.200.51.254
- DNS 네임 서버 : 서브넷에 대한 DNS 네임 서버의 IP 주소 목록
  + 입력값 :: 8.8.8.8

### 1.4 라우터 생성

> 관리 > 네트워크 > 라우터 > router1 클릭 > 인터페이스 > 인터페이스 추가

- 서브넷 :: 생성한 서브넷 선택
- IP 주소 :: 10.200.xx.1(게이트웨이)<br />

※ 생성한 서브넷 모두 생성 필요


### 1.5 보안 그룹 생성

> 프로젝트 > 네트워크 > 보안 그룹

1. 보안 그룹 생성
- 이름 :: c3-{name}-security ex) c3-joy-security

2. '규칙 관리' 클릭 > 규칙 추가
- 들어오는 방향의 규칙 추가 필요
  + ICMP
    - 규칙 :: 모든 ICMP
    - Direction :: 들어옴
    - 열린 포트 :: 모든 포트
    - 원격 :: CIDR
    - CIDR :: 0.0.0.0/0
  + TCP
    - 규칙 :: 사용자 정의 TCP 규칙
    - Direction :: 들어옴
    - 열린 포트 :: 포트 범위
    - 포트에서 :: 1
    - 포트로 :: 65535
    - 원격 :: CIDR
    - CIDR :: 0.0.0.0/0
  + SSH
    - 규칙 :: SSH
    - 원격 :: CIDR
    - CIDR :: 0.0.0.0/0
  + UDP
      - 규칙 :: 사용자 정의 UDP 규칙
      - Direction :: 들어옴
      - 열린 포트 :: 포트 범위
      - 포트에서 :: 1
      - 포트로 :: 65535
      - 원격 :: CIDR
      - CIDR :: 0.0.0.0/0
        
※ CCC팀에서는 생성되어있는 보안 그룹 사용

## 2. 키페어 생성

> 프로젝트 > Compute > 키 페어 > 키 페어 생성

- 키 페어 이름 :: c3-{name}-key ex) c3-joy-key
- Key Type :: SSH key로 지정
- 키 파일은 컴퓨터에 자동 저장됨

※ CCC팀에서는 생성되어있는 키페어 사용

## 3. 인스턴스 생성

### 3.1. 프로젝트 > Compute > 인스턴스 > 인스턴스 시작
   ![생성1](https://user-images.githubusercontent.com/74666378/141724797-f1913e36-3188-464f-8328-f1d6aa96809e.PNG)

### 3.2. 세부 정보 설정

- 인스턴스 이름 : 가상 머신 이름 지정 
  + c3-inception-{숫자} ex) `c3-inception-xx`
- 가용 구역 : 관리자가 지정한 호스트 존 표시
  + nova01
- 개수 :: 1
    + 동시에 여러 개의 가상 머신을 생성할 수 있는 기능
    + 지정한 숫자만큼 가상 머신 생성

### 3.3. 소스 설정

- 부팅 소스 : 가상 머신의 부팅에 사용할 이미지 지정
  + 부팅 소스 선택 :: 이미지
  + 새로운 볼륨 생성 :: 예
  + 볼륨 크기 :: 80
  + 인스턴스 삭제시 볼륨 삭제 :: 예
  + '사용 가능' 항목에서 ubuntu-18.04 선택
  + 참고(옵션)
    - 이미지 : Glance에 등록된 이미지 사용하여 부팅
      + 새 볼륨 생성 체크
          - 인스턴스를 부팅하기 위해 이미지를 사용
          - 인스턴스 데이터를 영구 보존하기 위해 새로운 볼륨 생성
    - 인스턴스 스냅샷 : 생성된 스냅샷 이미지 사용하여 부팅
      + 새 볼륨 생성 체크
          - 인스턴스를 부팅하기 위해 볼륨 스냅샷을 사용
          - 인스턴스 데이터를 영구 보존하기 위해 새로운 볼륨 생성
    - 볼륨 : 기존에 사용하던 볼륨 사용하여 부팅
    - 볼륨 스냅샷 : 지정한 스냅샷으로 부팅 및 새로운 볼륨 생성하여 가상 머신에 접근

### 3.4. Flavor 설정

> Flavor : 사전 정의된 가상 머신이 사용할 자원의 크기 지정

- 사용 가능 > 항목 선택 :: `m1.large`

### 3.5. 네트워크

- 사용 가능 > 생성한 네트워크 선택 ex) c3-private-joy-1
     
### 3.6. 보안 그룹

- 사용 가능 > 적용할 보안 그룹 선택 ex) c3-joy-security
- default와 생성한 보안 그룹 모두 적용 필요

### 3.7. 키 페어

- 사용 가능 > 적용할 키 페어 선택 ex) c3-joy-key

## 4. ProxyCap 설정
> configuration > Ruleset > Rules > 룰 선택 > IP Addresses
- IP 영역대 추가
  + First IP :: 10.200.x0.1
  + Last IP :: 10.200.x6.255

---

# OpenStack instance 삭제

## 1. 인스턴스 삭제

> 프로젝트 > Compute > 인스턴스 > 삭제하려는 인스턴스 이름 클릭 > 인터페이스 탭

### 1.1. 연결된 네트워크 확인 :: c3-private-{별명}-{숫자}

- 예시 
  +  c3-private-kevin-1

### 1.2. 이름 항목 클릭 > 개요 탭 > 네트워크 ID 클릭 > 서브넷 > 서브넷 및 게이트웨이 확인

- 예시
  + c3-private-kevin-1-sn-0, 10.200.50.1
  + c3-private-kevin-1-sn-1, 10.200.51.1
  + c3-private-kevin-1-sn-2, 10.200.52.1   
...

> 프로젝트 > Compute > 인스턴스 > 인스턴스 선택 및 삭제

## 2. 라우터 삭제

> 관리 > 네트워크 > 라우터 > router1 클릭 > 인터페이스 > 게이트웨이 선택 및 삭제

### 2.1. 인스턴스 삭제 시 확인한 게이트웨이 선택 후 삭제

- 예시
  + c3-private-kevin-1-sn-0, 10.200.50.1
  + c3-private-kevin-1-sn-1, 10.200.51.1
  + c3-private-kevin-1-sn-2, 10.200.52.1   
  ...

## 3. 네트워크 삭제

> 관리 > 네트워크 > 네트워크 >

### 3.1. 인스턴스 삭제 시 확인한 네트워크 선택 후 삭제
- 예시
  + c3-private-kevin-1

### 3.2. 삭제 진행이 안될 시 (error : 사용중인 포트가 있습니다.)

- 네트워크 클릭 > 포트 탭 > 전체 삭제